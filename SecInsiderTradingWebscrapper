import requests
from bs4 import BeautifulSoup
from pandas_datareader import data as pdr
import pandas as pd
import calendar

cal = calendar.Calendar()
for date in cal.itermonthdates(2020,12):
    date_time = date.strftime("%Y-%m-%d")
    URL = 'https://www.secform4.com/' + date_time + '/selling.htm'
    page = requests.get(URL)
    print(URL)
    print(page)

    soup = BeautifulSoup(page.content, 'html.parser')

    results = soup.find(id='filing_table')
    if results != None:
        table_rows = results.find_all('tr')
        header = table_rows[0].find_all('td')
        header_row = [i.text for i in header]
        insider_trading_table = [header_row]

        for tr in table_rows[1:]:
            td = tr.find_all('td')
            row = [i.text for i in td]
            insider_trading_table.append(row)

        df = pd.DataFrame(insider_trading_table)
        df.columns = df.iloc[0]
        df = df[1:]

        df.to_csv('insider_trading_tables/insider_trading_table_' + date_time + '.csv')

print('DONE')